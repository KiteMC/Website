# Backend API

## User Registration & Verification

### Send Email Verification Code
- **Endpoint**: `POST /api/send-code`
- **Purpose**: Send a registration verification code to the specified email to prevent abuse.
- **Permission**: Public (no authentication required)
- **Request Header**: `Content-Type: application/json`
- **Request Parameters**:
  | Field    | Type   | Required | Description         | Example             |
  |----------|--------|----------|---------------------|---------------------|
  | email    | string | Yes      | User email          | user@example.com    |
  | language | string | No       | Language (zh/en)    | en                  |
- **Request Example**:
  ```json
  { "email": "user@example.com", "language": "en" }
  ```
- **Response**:
  | Field   | Type    | Description      |
  |---------|---------|------------------|
  | success | boolean | Success or not   |
  | msg     | string  | Message          |
- **Success Example**:
  ```json
  { "success": true, "msg": "Verification code sent" }
  ```
- **Failure Example**:
  ```json
  { "success": false, "msg": "Invalid email format or already registered" }
  ```
- **Notes**:
  - Email sending is rate-limited per day/minute to prevent abuse.
  - Email format must comply with RFC standards.

### Register
- **Endpoint**: `POST /api/register`
- **Purpose**: User submits email verification code and info to register.
- **Permission**: Public
- **Request Header**: `Content-Type: application/json`
- **Request Parameters**:
  | Field    | Type   | Required | Description         |
  |----------|--------|----------|---------------------|
  | email    | string | Yes      | User email          |
  | code     | string | Yes      | Email verification code |
  | uuid     | string | Yes      | Player UUID         |
  | username | string | Yes      | Player name         |
  | language | string | No       | Language            |
- **Request Example**:
  ```json
  { "email": "user@example.com", "code": "123456", "uuid": "player-uuid", "username": "playername", "language": "en" }
  ```
- **Response**:
  | Field   | Type    | Description      |
  |---------|---------|------------------|
  | success | boolean | Success or not   |
  | msg     | string  | Message          |
- **Success Example**:
  ```json
  { "success": true, "msg": "Registration successful" }
  ```
- **Failure Example**:
  ```json
  { "success": false, "msg": "Verification code incorrect or expired" }
  ```
- **Notes**:
  - Verification code is usually valid for 5 minutes.
  - Username and email must be unique.
  - Registration may require admin approval.

## Admin & Review

### Admin Login
- **Endpoint**: `POST /api/admin-login`
- **Purpose**: Admin login to backend.
- **Permission**: Public
- **Request Header**: `Content-Type: application/json`
- **Request Parameters**:
  | Field    | Type   | Required | Description         |
  |----------|--------|----------|---------------------|
  | password | string | Yes      | Admin password      |
  | language | string | No       | Language            |
- **Request Example**:
  ```json
  { "password": "your_admin_password", "language": "en" }
  ```
- **Response**:
  | Field   | Type    | Description      |
  |---------|---------|------------------|
  | success | boolean | Success or not   |
  | token   | string  | JWT token        |
  | message | string  | Message          |
- **Success Example**:
  ```json
  { "success": true, "token": "JWT_TOKEN", "message": "Login successful" }
  ```
- **Failure Example**:
  ```json
  { "success": false, "message": "Incorrect password" }
  ```
- **Notes**:
  - All admin APIs require `Authorization: Bearer <token>` in the header after login.

### Get Pending User List
- **Endpoint**: `GET /api/pending-list?language=en`
- **Purpose**: Get all users pending review.
- **Permission**: Admin login required (token)
- **Request Header**: `Authorization: Bearer <token>`
- **Request Parameters**:
  | Field    | Type   | Required | Description         |
  |----------|--------|----------|---------------------|
  | language | string | No       | Language            |
- **Response**:
  | Field   | Type    | Description      |
  |---------|---------|------------------|
  | success | boolean | Success or not   |
  | users   | array   | User array       |
- **User Object Structure**:
  | Field    | Type   | Description         |
  |----------|--------|---------------------|
  | uuid     | string | Player UUID         |
  | username | string | Player name         |
  | email    | string | Email               |
  | status   | string | Status (pending)    |
  | regTime  | string | Registration time   |
- **Success Example**:
  ```json
  {
    "success": true,
    "users": [
      { "uuid": "...", "username": "...", "email": "...", "status": "pending", "regTime": "..." }
    ]
  }
  ```
- **Failure Example**:
  ```json
  { "success": false, "msg": "No permission" }
  ```

### Review User
- **Endpoint**: `POST /api/review`
- **Purpose**: Admin reviews user (approve/reject).
- **Permission**: Admin login required
- **Request Header**: `Authorization: Bearer <token>`, `Content-Type: application/json`
- **Request Parameters**:
  | Field    | Type   | Required | Description         |
  |----------|--------|----------|---------------------|
  | uuid     | string | Yes      | Player UUID         |
  | action   | string | Yes      | Action (approve/reject) |
  | reason   | string | No       | Reason (if rejected) |
  | language | string | No       | Language            |
- **Request Example**:
  ```json
  { "uuid": "...", "action": "approve", "reason": "", "language": "en" }
  ```
- **Response**:
  | Field   | Type    | Description      |
  |---------|---------|------------------|
  | success | boolean | Success or not   |
  | msg     | string  | Message          |
- **Success Example**:
  ```json
  { "success": true, "msg": "Operation successful" }
  ```
- **Failure Example**:
  ```json
  { "success": false, "msg": "No permission or user not found" }
  ```

## Other APIs

### Get Config
- **Endpoint**: `GET /api/config`
- **Purpose**: Get frontend, login, announcement and other config info.
- **Permission**: Public
- **Response**:
  | Field     | Type   | Description         |
  |-----------|--------|---------------------|
  | login     | object | Login config        |
  | admin     | object | Admin config        |
  | frontend  | object | Frontend config     |
- **Success Example**:
  ```json
  {
    "login": { "enable_email": true, "email_smtp": "smtp.qq.com" },
    "admin": { ... },
    "frontend": { "theme": "glassx", "logo_url": "/logo.png", ... }
  }
  ```

### Get User Status
- **Endpoint**: `GET /api/user-status?uuid=...`
- **Purpose**: Query the review status of a specific user.
- **Permission**: Public
- **Request Parameters**:
  | Field    | Type   | Required | Description         |
  |----------|--------|----------|---------------------|
  | uuid     | string | Yes      | Player UUID         |
- **Response**:
  | Field   | Type    | Description      |
  |---------|---------|------------------|
  | success | boolean | Success or not   |
  | data    | object  | User status data |
- **Data Object Structure**:
  | Field   | Type    | Description      |
  |---------|---------|------------------|
  | status  | string  | User status (approved/pending/rejected/banned) |
  | reason  | string  | Reason for rejection/ban (if any) |
- **Success Example**:
  ```json
  { "success": true, "data": { "status": "approved", "reason": "" } }
  ```

---

> For more APIs and parameters, see the source code or frontend `src/services/api.ts`. 